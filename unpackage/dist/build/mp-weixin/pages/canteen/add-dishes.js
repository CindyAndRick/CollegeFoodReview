(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/canteen/add-dishes"],{"2fa6":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return s}));var s={uniForms:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(i.bind(null,"9d30"))},uniSection:function(){return i.e("components/uni-section/uni-section").then(i.bind(null,"b506"))},uniFormsItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(i.bind(null,"b4d1"))},uniEasyinput:function(){return i.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(i.bind(null,"8b0a"))},uniFilePicker:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(i.bind(null,"cc85"))}},a=function(){var t=this,e=t.$createElement;t._self._c},n=[]},"340c":function(t,e,i){},"3ec4":function(t,e,i){"use strict";i.r(e);var s=i("714f"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e["default"]=a.a},"4ba9":function(t,e,i){"use strict";(function(t){i("4a2a");s(i("66fd"));var e=s(i("aa50"));function s(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},"6c20":function(t,e,i){"use strict";var s=i("340c"),a=i.n(s);a.a},"714f":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{id:"",dishId:"",userId:"",index:"",status:"",dishData:{dishId:"",dishName:"",price:"",score:"",intro:"",userId:"",merchantId:"",requestId:"",picture:"",images:[],tmp_images:[]},customRules:{name:{rules:[{required:!0,errorMessage:"菜品名称不能为空"}]},price:{rules:[{required:!0,errorMessage:"菜品价格不能为空"}]},intro:{rules:[{required:!0,errorMessage:"菜品介绍不能为空"}]}}}},onLoad:function(t){console.log(t),this.id=t.id,this.index=t.index,this.dishId=t.dishId,this.status=t.status,2==t.status?this.getUpdateInfo():1==t.status&&this.getMyInfo()},methods:{getMyInfo:function(){var e=this;t.getStorage({key:"userInfo",success:function(t){console.log(t),e.userId=t.data.id,console.log(e.userId),e.getDishesInfo()}})},getUpdateInfo:function(){var e=this;t.request({url:"http://124.71.170.100/index.php/index/getdishUpdateRequest",method:"GET",data:{canteenId:this.id},success:function(t){console.log(t.data.data.updateList[e.index]),e.dishData=t.data.data.updateList[e.index],e.dishData.tmp_images=t.data.data.updateList[e.index].pictureList,e.dishData.images=[],console.log(e.dishData);for(var i=0;i<e.dishData.tmp_images.length;i++){var s={url:e.dishData.tmp_images[i]};e.dishData.images.push(s)}}})},getDishesInfo:function(){var e=this;t.request({url:"http://124.71.170.100/index.php/index/getSingleDishInfo",data:{dishId:this.dishId,isCanteen:"1"},method:"GET",success:function(t){e.dishData=t.data.data,e.dishData.tmp_images=t.data.data.pictureList,e.dishData.images=[],console.log(e.dishData);for(var i=0;i<e.dishData.tmp_images.length;i++){var s={url:e.dishData.tmp_images[i]};e.dishData.images.push(s)}}})},submit:function(t,e){var i=this;this.$refs[t].validate().then((function(t){2==i.status?i.updateDish(t):1==i.status?i.editDish(t):i.addDish(t)})).catch((function(t){console.log("err",t)}))},selectImage:function(t){var e=this;console.log("选择图片",t),e.dishData.images=[];for(var i=0;i<e.dishData.tmp_images.length;i++){var s={url:e.dishData.tmp_images[i]};e.dishData.images.push(s)}for(var a=0;a<t.tempFilePaths.length;a++)e.$OBS.myUploadFile((new Date).getTime()+t.tempFiles[a].name,t.tempFilePaths[a],t.tempFiles[a].fileType,"se-canteen-dish").then((function(t){console.log("success",t),e.dishData.tmp_images.push(t),e.dishData.images=[];for(var i=0;i<e.dishData.tmp_images.length;i++){var s={url:e.dishData.tmp_images[i]};e.dishData.images.push(s)}}))},deleteImage:function(t){console.log(t),console.log(this.dishData.images);for(var e=0;e<this.dishData.tmp_images.length;e++)this.dishData.tmp_images[e]==t.tempFilePath&&this.dishData.tmp_images.splice(e,1)},updateDish:function(e){console.log(this.dishData),console.log(this.id),console.log(this.dishData.pictureList),t.request({url:"http://124.71.170.100/index.php/index/reviewdishUpdateRequest",header:{"content-type":"application/json"},data:{dishName:this.dishData.dishName,userId:this.dishData.userId,price:this.dishData.price,pictureList:this.dishData.pictureList,intro:this.dishData.intro,requestid:this.dishData.requestid,merchantId:this.dishData.merchantId},method:"POST",success:function(e){t.navigateBack(),t.showToast({mask:!0,title:"提交成功"})}})},editDish:function(e){console.log(e),console.log(this.dishData),t.request({url:"http://124.71.170.100/index.php/index/editDish",header:{"content-type":"application/json"},data:{dishName:this.dishData.dishName,dishId:this.dishData.dishId,price:this.dishData.price,pictureList:this.dishData.tmp_images,intro:this.dishData.intro,isCanteen:"1"},method:"POST",success:function(e){t.navigateBack(),t.showToast({mask:!0,title:"提交成功"})}})},addDish:function(e){console.log("添加菜品"),console.log(this.dishData),console.log(this.id),t.request({url:"http://124.71.170.100/index.php/index/addDish",header:{"content-type":"application/json"},data:{dishName:this.dishData.dishName,isCanteen:"1",price:this.dishData.price,pictureList:this.dishData.tmp_images,intro:this.dishData.intro,merchantId:this.id},method:"POST",success:function(e){console.log(e.data.code),t.navigateBack(),t.showToast({mask:!0,title:"提交成功"})}})}}};e.default=i}).call(this,i("543d")["default"])},aa50:function(t,e,i){"use strict";i.r(e);var s=i("2fa6"),a=i("3ec4");for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);i("6c20");var o,d=i("f0c5"),u=Object(d["a"])(a["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],o);e["default"]=u.exports}},[["4ba9","common/runtime","common/vendor"]]]);