(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/canteen/edit-canteen-info"],{"35a2":function(e,t,n){"use strict";n.r(t);var o=n("d1d0"),a=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=a.a},4786:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));var o={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"9d30"))},uniSection:function(){return n.e("components/uni-section/uni-section").then(n.bind(null,"b506"))},uniFormsItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(n.bind(null,"b4d1"))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,"8b0a"))},uniDataCheckbox:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox")]).then(n.bind(null,"8711"))},uniFilePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(n.bind(null,"cc85"))}},a=function(){var e=this,t=e.$createElement;e._self._c},s=[]},"7a24":function(e,t,n){"use strict";var o=n("b272"),a=n.n(o);a.a},b272:function(e,t,n){},d1d0:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){return{userInfo:{},canteenId:"",userId:"",status:"",canteenInfo:{nickName:"",avatarUrl:[],schoolId:"",address:"",tel:"",intro:"",pictureList:[],tmp_pictureList:[],categoryList:[],tmp_categoryList:[]},totalCategory:[],customRules:{name:{rules:[{required:!0,errorMessage:"食堂名称不能为空"}]},address:{rules:[{required:!0,errorMessage:"食堂地址不能为空"}]},telephone:{rules:[{required:!0,errorMessage:"联系电话不能为空"}]},introduction:{rules:[{required:!0,errorMessage:"食堂介绍不能为空"}]},categoryList:{rules:[{required:!1,errorMessage:"食堂标签不能为空"}]}}}},onShow:function(){},onLoad:function(t){var n=this;console.log(t),this.canteenId=t.id,this.userId=t.userId,this.getSchoolInfo(),this.getTotalCategoryList(),this.canteenId?(this.getCanteenInfo(),console.log("更新"),this.status=1):this.status=0,e.getStorage({key:"userInfo",success:function(e){n.userInfo=e.data}})},methods:{getSchoolInfo:function(){var t=this;e.getStorage({key:"userInfo",success:function(e){console.log(e.data.schoolId),t.canteenInfo.schoolId=e.data.schoolId}})},getTotalCategoryList:function(){var t=this;e.request({url:"http://124.71.170.100/index.php/index/getCategory",method:"GET",success:function(e){console.log(e.data.data.TotalCategoryList);for(var n=e.data.data.TotalCategoryList.length,o=0;o<n;o++){var a=new Object;a.text=e.data.data.TotalCategoryList[o],a.value=o,console.log(a),t.totalCategory.push(a)}}})},getCanteenInfo:function(){var t=this;e.request({url:"http://124.71.170.100/index.php/index/getOneCanteenInfo",data:{userId:this.userInfo.id,canteenId:this.canteenId},method:"GET",success:function(e){var n=e.data.data;if(console.log(e.data.data),console.log(t.totalCategory),""!=n.avatarUrl){var o={url:n.avatarUrl};t.canteenInfo.avatarUrl.push(o)}t.canteenInfo.address=n.address;for(var a=0;a<n.categoryList.length;a++)t.canteenInfo.categoryList.push(Number(n.categoryList[a])-2);console.log(n.categoryList),console.log(t.canteenInfo.categoryList),t.canteenInfo.intro=n.intro,t.canteenInfo.nickName=n.nickName,t.canteenInfo.tmp_pictureList=n.pictureList,t.canteenInfo.tel=n.tel;for(var s=0;s<n.pictureList.length;s++){var i={url:n.pictureList[s]};t.canteenInfo.pictureList.push(i)}}})},submit:function(e,t){var n=this;this.$refs[e].validate().then((function(e){console.log("success",e),n.submitForm(e)})).catch((function(e){console.log("err",e)}))},selectImage:function(e){var t=this;console.log("选择图片",e),t.canteenInfo.pictureList=[];for(var n=0;n<t.canteenInfo.tmp_pictureList.length;n++){var o={url:t.canteenInfo.tmp_pictureList[n]};t.canteenInfo.pictureList.push(o)}for(var a=0;a<e.tempFilePaths.length;a++)t.$OBS.myUploadFile(e.tempFiles[a].name,e.tempFilePaths[a],e.tempFiles[a].fileType,"se-canteen").then((function(e){console.log("success",e),t.canteenInfo.tmp_pictureList.push(e),t.canteenInfo.pictureList=[];for(var n=0;n<t.canteenInfo.tmp_pictureList.length;n++){var o={url:t.canteenInfo.tmp_pictureList[n]};t.canteenInfo.pictureList.push(o)}}))},selectAvatar:function(e){var t=this;console.log("选择图片",e),t.$OBS.myUploadFile(e.tempFiles[0].name,e.tempFilePaths[0],e.tempFiles[0].fileType,"se-user-avatar").then((function(e){console.log("success",e),t.canteenInfo.avatarUrl=[];var n={url:e};t.canteenInfo.avatarUrl.push(n)}))},deleteImage:function(e){console.log(e),console.log(this.canteenInfo.pictureList);for(var t=0;t<this.canteenInfo.tmp_pictureList.length;t++)this.canteenInfo.tmp_pictureList[t]==e.tempFilePath&&this.canteenInfo.tmp_pictureList.splice(t,1)},submitForm:function(t){console.log(t);var n=[];console.log(t.categoryList);for(var o=0;o<t.categoryList.length;o++)n.push((t.categoryList[o]+2).toString()),t.categoryList[o]=t.categoryList[o]+2;1==this.status?(console.log("changeCanteenInfo"+this.canteenId),console.log(this.canteenInfo.avatarUrl),console.log(n),e.request({url:"http://124.71.170.100/index.php/index/editInfo",header:{"content-type":"application/json"},data:{nickName:t.name,id:this.canteenId,avatarUrl:null==this.canteenInfo.avatarUrl?"":this.canteenInfo.avatarUrl[0].url,intro:t.introduction,tel:t.telephone,address:t.address,categoryList:t.categoryList,pictureList:this.canteenInfo.tmp_pictureList,isCanteen:"1"},method:"POST",success:function(t){console.log(t),e.navigateBack({url:"canteenList"}),e.showToast({mask:!0,title:"提交成功"})}})):(console.log(this.canteenInfo.schoolId+" 学校id"),console.log(n),e.request({url:"http://124.71.170.100/index.php/index/createCanteen",header:{"content-type":"application/json"},data:{name:t.name,avatarUrl:null==this.canteenInfo.avatarUrl?"":this.canteenInfo.avatarUrl[0].url,intro:t.introduction,schoolId:this.canteenInfo.schoolId,tel:t.telephone,address:t.address,categoryList:n,pictureList:this.canteenInfo.tmp_pictureList},method:"POST",success:function(t){console.log(t.data.code),console.log(t.data.data.canteenId),e.navigateBack({url:"canteenList"}),e.showToast({mask:!0,title:"提交成功"})}}))}}};t.default=n}).call(this,n("543d")["default"])},d594:function(e,t,n){"use strict";n.r(t);var o=n("4786"),a=n("35a2");for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n("7a24");var i,r=n("f0c5"),c=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=c.exports},f032:function(e,t,n){"use strict";(function(e){n("4a2a");o(n("66fd"));var t=o(n("d594"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])}},[["f032","common/runtime","common/vendor"]]]);