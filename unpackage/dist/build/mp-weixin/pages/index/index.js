(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"05c0":function(e,t,o){"use strict";var n=o("53ef"),a=o.n(n);a.a},"15ef":function(e,t,o){"use strict";o.r(t);var n=o("a93b"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},2457:function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}));var n={uniCombox:function(){return o.e("uni_modules/uni-combox/components/uni-combox/uni-combox").then(o.bind(null,"e3a9"))},uniSearchBar:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar")]).then(o.bind(null,"f983"))},uniGrid:function(){return o.e("uni_modules/uni-grid/components/uni-grid/uni-grid").then(o.bind(null,"839c"))},uniGridItem:function(){return o.e("uni_modules/uni-grid/components/uni-grid-item/uni-grid-item").then(o.bind(null,"fc0a"))},uniCard:function(){return o.e("uni_modules/uni-card/components/uni-card/uni-card").then(o.bind(null,"1a0f"))},lbTabbar:function(){return Promise.all([o.e("common/vendor"),o.e("components/lb-tabbar/lb-tabbar")]).then(o.bind(null,"b226"))},lbTabbarItem:function(){return Promise.all([o.e("common/vendor"),o.e("components/lb-tabbar/lb-tabbar-item")]).then(o.bind(null,"26a2"))}},a=function(){var e=this,t=e.$createElement;e._self._c},i=[]},"3fba":function(e,t,o){"use strict";(function(e){o("4a2a");n(o("66fd"));var t=n(o("631d"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o("543d")["createPage"])},"53ef":function(e,t,o){},"631d":function(e,t,o){"use strict";o.r(t);var n=o("2457"),a=o("15ef");for(var i in a)"default"!==i&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("05c0");var s,c=o("f0c5"),r=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=r.exports},a93b:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{id:"",userInfo:{},searchValue:"",selectedSchoolName:"",schoolId:"",schools:[],schoolIdList:[],storeList:[],category:[],activityList:[],active:"",animate:"zoomIn",height:"",tabbarHeight:"",tabbar_user:[{name:"index",text:"首页",icon:"../../static/icons/rank-active.png"},{name:"moments",text:"动态",icon:"../../static/icons/explore.png"},{name:"message",text:"消息",icon:"../../static/icons/message.png"},{name:"home",text:"我的",icon:"../../static/icons/homepage.png"}],tabbar_merchant:[{name:"index",text:"首页",icon:"../../static/icons/rank-active.png"},{name:"message",text:"消息",icon:"../../static/icons/message.png"},{name:"homepage",text:"我的",icon:"../../static/icons/homepage.png"}],tabbar_admin:[{name:"index",text:"首页",icon:"../../static/icons/rank-active.png"},{name:"manage",text:"管理",icon:"../../static/icons/cube.png"},{name:"canteen",text:"食堂",icon:"../../static/icons/edit.png"}]}},onLoad:function(){var t=this,o=this;e.request({url:"http://124.71.170.100/index.php/index/getSchoolList",method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},success:function(n){console.log("获取学校列表成功:"+n.data.data.schoolList);for(var a=0;a<n.data.data.schoolList.length;a++)t.schools[a]=n.data.data.schoolList[a].schoolName,t.schoolIdList[a]=n.data.data.schoolList[a].schoolId;e.getStorage({key:"userInfo",success:function(t){console.log(t.data),o.userInfo=t.data,o.id=t.data.id,o.identity=t.data.identity,o.schoolId=t.data.schoolId,o.selectedSchoolName=t.data.schoolName,o.refresh(t.data.schoolId),"2"==t.data.identity&&e.request({url:"http://124.71.170.100/index.php/index/getStoreInfo",data:{id:t.data.id},method:"GET",success:function(t){""==t.data.data.nickName&&""==t.data.data.address&&""==t.data.data.tel&&""==t.data.data.intro&&(e.showToast({title:"请完善商家信息",icon:"error",duration:1e3,mask:!0}),setTimeout((function(){e.redirectTo({url:"../merchant-pages/edit-store-info"})}),1e3))}})}})}})},onShow:function(){wx.hideHomeButton()},onPullDownRefresh:function(){console.log("refresh");var t=this;setTimeout((function(){t.refresh(t.schoolId),e.stopPullDownRefresh()}),1e3)},methods:{handleChange:function(t){if(console.log("change::",t),0==this.userInfo.identity)switch(t.name){case"manage":e.redirectTo({url:"../admin/manage"});break;case"canteen":e.redirectTo({url:"../canteen/canteenList"});break;default:break}else if(1==this.userInfo.identity)switch(t.name){case"moments":e.redirectTo({url:"/pages/moments/moments"});break;case"message":e.redirectTo({url:"/pages/message/message"});break;case"home":e.redirectTo({url:"/pages/home/my"});break;default:break}else if(2==this.userInfo.identity)switch(t.name){case"message":e.redirectTo({url:"/pages/message/message"});break;case"homepage":e.redirectTo({url:"/pages/merchant-pages/store-homepage"});break;default:break}},reload:function(){var e=getCurrentPages(),t=e[e.length-1];t.onLoad(t.options),t.onShow(),t.onReady()},refreshSchool:function(){for(var t=this,o=0,n=0;n<this.schoolIdList.length;n++)if(this.selectedSchoolName==this.schools[n]){o=n;break}console.log("所选择的学校是："+this.schools[o]),this.schoolId=this.schoolIdList[o],e.request({url:"http://124.71.170.100/index.php/index/updateSchoolInfo",method:"POST",header:{"content-type":"application/json"},data:{schoolId:this.schoolIdList[o],id:this.id},success:function(n){console.log("选择学校成功"),console.log(n),t.userInfo.schoolId=t.schoolIdList[o],t.userInfo.schoolName=t.schools[o],e.setStorage({data:t.userInfo,key:"userInfo",success:function(){}}),t.refresh(t.schoolIdList[o]),t.reload()}})},refresh:function(t){var o=this;e.request({url:"http://124.71.170.100/index.php/index/getStore_Act_throughSchoolid",method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},data:{schoolId:t},success:function(e){console.log(e),console.log(t),o.storeList=e.data.data.storeList,o.category=e.data.data.category,o.activityList=e.data.data.activityList,console.log("刷新成功")},fail:function(){console.log("刷新失败")}})},seeAll:function(){console.log("查看全部"),e.navigateTo({url:"/pages/index/all-category?schoolId="+this.schoolId})},categoryClick:function(t){var o=t.detail.index;console.log(this.category[o].name+"被点击了"),e.navigateTo({url:"/pages/index/category?categoryName="+this.category[o].name+"&schoolId="+this.schoolId})},search:function(t){console.log("搜索："+this.searchValue),e.navigateTo({url:"/pages/index/search?res="+this.searchValue})},activityClick:function(t){console.log(this.activityList[t].activityName+"被点击了"),e.navigateTo({url:"/pages/index/activities?activityId="+this.activityList[t].activityId})},storeClick:function(t){console.log(this.storeList[t].nickName+"被点击了"),e.navigateTo({url:"/pages/index/store?id="+this.storeList[t].id+"&isCanteen="+this.storeList[t].isCanteen})},progressImgClick:function(t){var o=this;e.previewImage({urls:t,longPressActions:{itemList:["保存图片"],success:function(t){e.downloadFile({url:o.progress_imgs[t.index],success:function(t){200===t.statusCode&&e.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(){e.showToast({title:"保存成功",icon:"success"})},fail:function(){e.showToast({title:"保存失败，请稍后重试",icon:"none"})}})}})},fail:function(e){console.log(e.errMsg)}}})}}};t.default=o}).call(this,o("543d")["default"])}},[["3fba","common/runtime","common/vendor"]]]);